<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://jack-d-long.github.io/ name=base><title>
         Lab 2
        
    </title><meta content="Lab 2" property=og:title><meta content="This is an example description" property=og:description><meta content="This is an example description" name=description><link href=/alien.png rel=icon type=image/png><link href=https://jack-d-long.github.io/fonts.css rel=stylesheet><script src=https://jack-d-long.github.io/js/codeblock.js></script><script src=https://jack-d-long.github.io/js/toc.js></script><script src=https://jack-d-long.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Jack Long" href=https://jack-d-long.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://jack-d-long.github.io/theme/light.css rel=stylesheet><link href=https://jack-d-long.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://jack-d-long.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://jack-d-long.github.io/main.css media=screen rel=stylesheet><script src=https://jack-d-long.github.io/js/mermaid.js></script><script src="https://jack-d-long.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://jack-d-long.github.io/>Jack Long</a><div class=socials><a class=social href=https://linkedin.com/in/jacklong257 rel=me> <img alt=linkedin src=https://jack-d-long.github.io/social_icons/linkedin.svg> </a><a class=social href=https://github.com/jack-d-long/ rel=me> <img alt=github src=https://jack-d-long.github.io/social_icons/github.svg> </a></div></div><nav><a href=https://jack-d-long.github.io/portfolio style=margin-left:.25em>/portfolio</a><a href=https://jack-d-long.github.io/about style=margin-left:.25em>/about</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://jack-d-long.github.io/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://jack-d-long.github.io/feather/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://jack-d-long.github.io/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>Lab 2<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2025-02-07</time></div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#previous-lab-1b>Previous: Lab 1B</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#lab-tasks>Lab Tasks</a> <ul><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#set-up-the-imu>Set up the IMU</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#accelerometer>Accelerometer</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#gyroscope>Gyroscope</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#sample-data>Sample Data</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#record-a-stunt>Record a Stunt</a><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#collaborations>Collaborations</a></ul><li><a href=https://jack-d-long.github.io/fast-robots/lab2/#next-lab-3>Next: Lab 3</a></ul></div><section class=body><h1 id=previous-lab-1b><a aria-label="Anchor link for: previous-lab-1b" class=zola-anchor href=#previous-lab-1b>Previous: <a href=/fast-robots/lab1b>Lab 1B</a></a></h1><h1 id=lab-tasks><a aria-label="Anchor link for: lab-tasks" class=zola-anchor href=#lab-tasks>Lab Tasks</a></h1><h2 id=set-up-the-imu><a aria-label="Anchor link for: set-up-the-imu" class=zola-anchor href=#set-up-the-imu>Set up the IMU</a></h2><br><img alt="Artemis and IMU" src=/files/lab2/IMUsetup.jpg width=400><p>The serial output of the example code given is as shown:</p><iframe allowfullscreen height=315 src=https://youtube.com/embed/ytyu0kU6aGI width=450></iframe><p>We set AD0_VAL to 1 to define the I2C address of the IMU. In this case, it maintains the default address of 0x12.<h2 id=accelerometer><a aria-label="Anchor link for: accelerometer" class=zola-anchor href=#accelerometer>Accelerometer</a></h2><p>The accelerometer seems to be accurate and responsive to angle changes, but not at all precise.</p><br><img alt="Initial accelerometer data" src=/files/lab2/AccelerometerPitchRollTime.png width=550><iframe allowfullscreen height=315 src=https://youtube.com/embed/DPVjiCiOTgU width=450></iframe><div class=note-container><button class=note-toggle><div class=note-icon><p>Pitch and Roll</div></button><div class=note-content style=display:none><pre class=language-c++ data-lang=c++ style=color:#61676c;background-color:#fafafa><code class=language-c++ data-lang=c++><span>    pitch_a </span><span style=color:#ed9366>= </span><span style=color:#f07171>atan2</span><span>(myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accX</span><span>()</span><span style=color:#61676ccc>,</span><span>myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accZ</span><span>())</span><span style=color:#ed9366>*</span><span style=color:#ff8f40>180</span><span style=color:#ed9366>/</span><span>M_PI</span><span style=color:#61676ccc>; 
</span><span>    roll_a  </span><span style=color:#ed9366>= </span><span style=color:#f07171>atan2</span><span>(myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accY</span><span>()</span><span style=color:#61676ccc>,</span><span>myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accZ</span><span>())</span><span style=color:#ed9366>*</span><span style=color:#ff8f40>180</span><span style=color:#ed9366>/</span><span>M_PI</span><span style=color:#61676ccc>; 
</span></code></pre></div></div><p>The accelerometer is very noisy, and becomes less accurate as pitch and roll tend to 90 degrees. This is because when either the pitch or roll axes approach the gravitational acceleration vector, the accelerometer is no longer able to read rotation data about that axis. I found the following noise spectrum when running the car nearby the IMU.</p><img alt="Initial accelerometer data" src=/files/lab2/fftGood.png width=600><p>With strong noise peaks above 10 Hz, especially in pitch, a cutoff frequency of 10 Hz seemed reasonable for my calculation of $\alpha$. We first found $RC$ and substituted to find $\alpha$ using the equations $$ f_c = \frac{1}{2\pi RC} $$ $$ \alpha = \frac{T_s}{T_s + RC} $$<p>Where $T_s$ is the sampling period of the IMU, given in seconds. For the given noise spectrum, I calculated $\alpha = .077$, producing the following low-pass-filtered car noise and ringdown readings.</p><img alt="FFT LPF car noise" src=/files/lab2/FFTLPF.png width=800><img alt="FFT LPF ringdown" src=/files/lab2/lpfringdown.png width=800><h2 id=gyroscope><a aria-label="Anchor link for: gyroscope" class=zola-anchor href=#gyroscope>Gyroscope</a></h2><p>The accelerometer roughly tracked the changes in pitch, roll, and yaw expected from movement of the IMU and accelerometer readings, but struggled with the angle offset due to lack of initial conditions in the integrator. I also saw significant integrated error, especially in yaw. When the Artemis was kept static about the accelerometer and gyroscope z axis, yaw appeared to vary linearly.</p><img alt="Gyro unfilterd" src=/files/lab2/gyroInttro.png width=800><p>With the complementary filter in place (in this case with $\alpha=.08$, similar to the pitch and roll LPF), pitch and roll values appeared to track the actual motion of the IMU much more closely, and lacked the high-frequency noise present even in the LPF accelerometer readings.<div class=note-container><button class=note-toggle><div class=note-icon><p>Complementary Filter</div></button><div class=note-content style=display:none><pre class=language-c++ data-lang=c++ style=color:#61676c;background-color:#fafafa><code class=language-c++ data-lang=c++><span>
</span><span style=color:#fa6e32>const float</span><span> alpha_gyro </span><span style=color:#ed9366>= </span><span style=color:#61676ccc>.</span><span style=color:#ff8f40>08</span><span style=color:#61676ccc>;
</span><span>dt </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#f29718>micros</span><span>()</span><span style=color:#ed9366>-</span><span>last_time)</span><span style=color:#ed9366>/</span><span style=color:#ff8f40>1000000</span><span style=color:#61676ccc>.;
</span><span>last_time </span><span style=color:#ed9366>= </span><span style=color:#f29718>micros</span><span>()</span><span style=color:#61676ccc>; 
</span><span>gyroFiltered[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>= </span><span>(gyroFiltered[valsStored </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1</span><span>][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>+</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>*</span><span> dt) </span><span style=color:#ed9366>* </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366>-</span><span> alpha_gyro) </span><span style=color:#ed9366>+ </span><span>(LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>*</span><span> alpha_gyro)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// pitch 
</span><span>gyroFiltered[valsStored][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>= </span><span>(gyroFiltered[valsStored </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1</span><span>][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>+</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>*</span><span> dt) </span><span style=color:#ed9366>* </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366>-</span><span> alpha_gyro) </span><span style=color:#ed9366>+ </span><span>(LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>*</span><span> alpha_gyro)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// roll
</span><span>gyroFiltered[valsStored][</span><span style=color:#ff8f40>2</span><span>]   </span><span style=color:#ed9366>=</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>2</span><span>]</span><span style=color:#61676ccc>;
</span></code></pre></div></div><img alt="Gyro fitered" src=/files/lab2/compfilter.png width=800><p>Yaw remained unfiltered as there is no accelerometer data to complement it.<h2 id=sample-data><a aria-label="Anchor link for: sample-data" class=zola-anchor href=#sample-data>Sample Data</a></h2><p>With serial monitor prints removed, the IMU sampled at approximately 300 Hz. I found that, over a 5 sceond period, the main loop ran 3573921 times and only stored 1538 values. This means that the IMU is definitely bottlenecking our data recording.<div class=note-container><button class=note-toggle><div class=note-icon><p>main loop</div></button><div class=note-content style=display:none><pre class=language-c++ data-lang=c++ style=color:#61676c;background-color:#fafafa><code class=language-c++ data-lang=c++><span style=color:#fa6e32>while </span><span>(central</span><span style=color:#ed9366>.</span><span style=color:#f29718>connected</span><span>()) {
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Send data
</span><span>            </span><span style=color:#f29718>write_data</span><span>()</span><span style=color:#61676ccc>;
</span><span>
</span><span>            looped</span><span style=color:#ed9366>++</span><span style=color:#61676ccc>;
</span><span>            </span><span style=color:#fa6e32>if</span><span>(startRecording</span><span style=color:#ed9366>&&</span><span>myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>dataReady</span><span>()){
</span><span>              </span><span style=color:#f29718>record_IMU</span><span>()</span><span style=color:#61676ccc>;
</span><span>            }
</span><span>            </span><span style=color:#abb0b6;font-style:italic>// Read data
</span><span>            </span><span style=color:#f29718>read_data</span><span>()</span><span style=color:#61676ccc>;
</span><span>        }
</span></code></pre></div></div><p><div class=note-container><button class=note-toggle><div class=note-icon><p>record_IMU()</div></button><div class=note-content style=display:none><pre class=language-c++ data-lang=c++ style=color:#61676c;background-color:#fafafa><code class=language-c++ data-lang=c++><span style=color:#fa6e32>void
</span><span style=color:#f29718>record_IMU</span><span>()
</span><span>{
</span><span>
</span><span>  </span><span style=color:#fa6e32>if </span><span>(valsStored </span><span style=color:#ed9366>&lt;</span><span> storeThisMuch){
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// computation variables global
</span><span>
</span><span>    
</span><span>    myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>getAGMT</span><span>()</span><span style=color:#61676ccc>;
</span><span>    
</span><span>    pitch_a </span><span style=color:#ed9366>= </span><span style=color:#f07171>atan2</span><span>(myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accX</span><span>()</span><span style=color:#61676ccc>,</span><span>myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accZ</span><span>())</span><span style=color:#ed9366>*</span><span style=color:#ff8f40>180</span><span style=color:#ed9366>/</span><span>M_PI</span><span style=color:#61676ccc>; 
</span><span>    roll_a  </span><span style=color:#ed9366>= </span><span style=color:#f07171>atan2</span><span>(myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accY</span><span>()</span><span style=color:#61676ccc>,</span><span>myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>accZ</span><span>())</span><span style=color:#ed9366>*</span><span style=color:#ff8f40>180</span><span style=color:#ed9366>/</span><span>M_PI</span><span style=color:#61676ccc>; 
</span><span>    pitchRollsTimes[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>=</span><span> pitch_a</span><span style=color:#61676ccc>;
</span><span>    pitchRollsTimes[valsStored][</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>=</span><span> roll_a</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// LPF
</span><span>
</span><span>
</span><span>    </span><span style=color:#fa6e32>const float</span><span> alpha </span><span style=color:#ed9366>= </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>.</span><span style=color:#ff8f40>08</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>//for now same for pitch, roll
</span><span>    pitch_a_LPF[n] </span><span style=color:#ed9366>=</span><span> alpha</span><span style=color:#ed9366>*</span><span>pitch_a </span><span style=color:#ed9366>+ </span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#ed9366>-</span><span>alpha)</span><span style=color:#ed9366>*</span><span>pitch_a_LPF[n</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1</span><span>]</span><span style=color:#61676ccc>;
</span><span>    pitch_a_LPF[n</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>=</span><span> pitch_a_LPF[n]</span><span style=color:#61676ccc>;
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Serial.print(", pitch_LPF:");
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Serial.println(pitch_a_LPF[n]);
</span><span>    LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>=</span><span> pitch_a_LPF[n]</span><span style=color:#61676ccc>;
</span><span>    roll_a_LPF[n] </span><span style=color:#ed9366>=</span><span> alpha</span><span style=color:#ed9366>*</span><span>roll_a </span><span style=color:#ed9366>+ </span><span>(</span><span style=color:#ff8f40>1</span><span style=color:#ed9366>-</span><span>alpha)</span><span style=color:#ed9366>*</span><span>roll_a_LPF[n</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1</span><span>]</span><span style=color:#61676ccc>;
</span><span>    roll_a_LPF[n</span><span style=color:#ed9366>-</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>=</span><span> roll_a_LPF[n]</span><span style=color:#61676ccc>;
</span><span>    LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>=</span><span> roll_a_LPF[n]</span><span style=color:#61676ccc>;
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// end LPF
</span><span>
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Start gyro
</span><span>
</span><span>    dt </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#f29718>micros</span><span>()</span><span style=color:#ed9366>-</span><span>last_time)</span><span style=color:#ed9366>/</span><span style=color:#ff8f40>1000000</span><span style=color:#61676ccc>.;
</span><span>    last_time </span><span style=color:#ed9366>= </span><span style=color:#f29718>micros</span><span>()</span><span style=color:#61676ccc>;
</span><span>    pitch_g </span><span style=color:#ed9366>=</span><span> pitch_g </span><span style=color:#ed9366>+</span><span> myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>gyrX</span><span>()</span><span style=color:#ed9366>*</span><span>dt</span><span style=color:#61676ccc>;
</span><span>    roll_g </span><span style=color:#ed9366>=</span><span> roll_g </span><span style=color:#ed9366>+</span><span> myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>gyrY</span><span>()</span><span style=color:#ed9366>*</span><span>dt</span><span style=color:#61676ccc>;
</span><span>    yaw_g </span><span style=color:#ed9366>=</span><span> yaw_g </span><span style=color:#ed9366>+</span><span> myICM</span><span style=color:#ed9366>.</span><span style=color:#f29718>gyrZ</span><span>()</span><span style=color:#ed9366>*</span><span>dt</span><span style=color:#61676ccc>;
</span><span>
</span><span>    gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>=</span><span> pitch_g</span><span style=color:#61676ccc>;
</span><span>    gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>=</span><span> roll_g</span><span style=color:#61676ccc>;
</span><span>    gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>2</span><span>] </span><span style=color:#ed9366>=</span><span> yaw_g</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>//[pitch, roll, yaw]
</span><span>
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// Filter 
</span><span>    </span><span style=color:#fa6e32>const float</span><span> alpha_gyro </span><span style=color:#ed9366>= </span><span style=color:#61676ccc>.</span><span style=color:#ff8f40>08</span><span style=color:#61676ccc>;
</span><span>    dt </span><span style=color:#ed9366>= </span><span>(</span><span style=color:#f29718>micros</span><span>()</span><span style=color:#ed9366>-</span><span>last_time)</span><span style=color:#ed9366>/</span><span style=color:#ff8f40>1000000</span><span style=color:#61676ccc>.;
</span><span>    last_time </span><span style=color:#ed9366>= </span><span style=color:#f29718>micros</span><span>()</span><span style=color:#61676ccc>; 
</span><span>    gyroFiltered[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>= </span><span>(gyroFiltered[valsStored </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1</span><span>][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>+</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>*</span><span> dt) </span><span style=color:#ed9366>* </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366>-</span><span> alpha_gyro) </span><span style=color:#ed9366>+ </span><span>(LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>1</span><span>] </span><span style=color:#ed9366>*</span><span> alpha_gyro)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// pitch 
</span><span>    gyroFiltered[valsStored][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>= </span><span>(gyroFiltered[valsStored </span><span style=color:#ed9366>- </span><span style=color:#ff8f40>1</span><span>][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>+</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>1</span><span>]  </span><span style=color:#ed9366>*</span><span> dt) </span><span style=color:#ed9366>* </span><span>(</span><span style=color:#ff8f40>1 </span><span style=color:#ed9366>-</span><span> alpha_gyro) </span><span style=color:#ed9366>+ </span><span>(LPFPitchRolls[valsStored][</span><span style=color:#ff8f40>0</span><span>] </span><span style=color:#ed9366>*</span><span> alpha_gyro)</span><span style=color:#61676ccc>; </span><span style=color:#abb0b6;font-style:italic>// roll
</span><span>    gyroFiltered[valsStored][</span><span style=color:#ff8f40>2</span><span>]   </span><span style=color:#ed9366>=</span><span> gyrosPitchRollYaws[valsStored][</span><span style=color:#ff8f40>2</span><span>]</span><span style=color:#61676ccc>;
</span><span>
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>//end filter 
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>// end gyro
</span><span>
</span><span>    
</span><span>    currentMillis </span><span style=color:#ed9366>= </span><span style=color:#f29718>millis</span><span>()</span><span style=color:#61676ccc>;
</span><span>    timeStamps[valsStored] </span><span style=color:#ed9366>=</span><span> currentMillis</span><span style=color:#61676ccc>;
</span><span>    valsStored</span><span style=color:#ed9366>++</span><span style=color:#61676ccc>;
</span><span>    }</span><span style=color:#abb0b6;font-style:italic>//endif
</span><span>
</span><span>}
</span></code></pre></div></div> I decided to store IMU data as float. The high precision of doubles doesn't really make sense for the IMU, whose outputs have significant noise even after filtering. I stored time as an int, because (at least for now) I don't expect to run the device for more than INT_MAX milliseconds (25 days). <p>I chose 2D arrays for each data set (e.g. filtered accelerometer, raw gyro) because it made my code more organized. However, it's slightly more difficult to determine whether pitch, roll, and yaw are being indexed for a particular data set. There may be slight performance benefits for using 2D arrays over multiple 1D arrays due to locality, but I was unable to measure any difference in this use case.<p>At each time step, the Artemis records the following data, as shown above:<ul><li>time (one int)<li>raw accelerometer (two floats)<li>filtered accelerometer (two floats)<li>raw gyroscope (three floats)<li>filtered gyroscope (three floats)</ul><p>This means a total of 44 bytes are being stored at a time, so, assuming the 350kB of dynamic memory available as in lab 1B, we can store just under 8000 time steps. For an average measured sample rate of 300 Hz, this gives us around <strong>27 seconds of IMU data recording</strong>.<p>The above plots show well over 5 seconds of data transmitted by BLE.<h2 id=record-a-stunt><a aria-label="Anchor link for: record-a-stunt" class=zola-anchor href=#record-a-stunt>Record a Stunt</a></h2><iframe allowfullscreen height=315 src=https://youtube.com/embed/TLcFdr-ZEDI width=450></iframe><p>Any fine control of the car appeared impossible -- I was only able to signal movements at full speed, leading to chronic oversteer and instability when control inputs were held for too long.<h2 id=collaborations><a aria-label="Anchor link for: collaborations" class=zola-anchor href=#collaborations>Collaborations</a></h2><p>I worked with <a href=https://correial.github.io/>Lucca Correia</a> and <a href=https://trevordales.github.io/>Trevor Dales</a> extensively, and referenced <a href=https://pages.github.coecis.cornell.edu/dak267/dak267.github.io/#contact>Daria's site</a> to troubleshoot FFT code. I used ChatGPT to generate a faster Python notification handler with less dictionary operations, for plotting syntax, and for more information on FFT implementation.<h1 id=next-lab-3><a aria-label="Anchor link for: next-lab-3" class=zola-anchor href=#next-lab-3>Next: <a href=/fast-robots/lab3>Lab 3</a></a></h1></section></article></main><div class=giscus></div><script -- <!-- <-- change repo src=https://utteranc.es/client.js this to your>issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script></div>