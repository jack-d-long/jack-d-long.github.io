<!doctype html><html class="dark light" lang=en><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://jack-d-long.github.io/ name=base><title>
         Lab 10
        
    </title><meta content="Lab 10" property=og:title><meta content="This is an example description" property=og:description><meta content="This is an example description" name=description><link href=/alien.png rel=icon type=image/png><link href=https://jack-d-long.github.io/fonts.css rel=stylesheet><script src=https://jack-d-long.github.io/js/codeblock.js></script><script src=https://jack-d-long.github.io/js/toc.js></script><script src=https://jack-d-long.github.io/js/note.js></script><script>MathJax = {
              tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']]
              }
            };</script><script async id=MathJax-script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><link title="Jack Long" href=https://jack-d-long.github.io/atom.xml rel=alternate type=application/atom+xml><link href=https://jack-d-long.github.io/theme/light.css rel=stylesheet><link href=https://jack-d-long.github.io/theme/dark.css id=darkModeStyle rel=stylesheet><script src=https://jack-d-long.github.io/js/themetoggle.js></script><script>setTheme(getSavedTheme());</script><link href=https://jack-d-long.github.io/main.css media=screen rel=stylesheet><script src=https://jack-d-long.github.io/js/mermaid.js></script><script src="https://jack-d-long.github.io/js/searchElasticlunr.min.js?h=3626c0ef99daa745b31e" defer></script><body><div class=content><header><div class=main><a href=https://jack-d-long.github.io/>Jack Long</a><div class=socials><a class=social href=https://linkedin.com/in/jacklong257 rel=me> <img alt=linkedin src=https://jack-d-long.github.io/social_icons/linkedin.svg> </a><a class=social href=https://github.com/jack-d-long/ rel=me> <img alt=github src=https://jack-d-long.github.io/social_icons/github.svg> </a></div></div><nav><a href=https://jack-d-long.github.io/portfolio style=margin-left:.25em>/portfolio</a><a href=https://jack-d-long.github.io/about style=margin-left:.25em>/about</a><button title="$SHORTCUT to open search" class=search-button id=search-button><img alt=Search class=search-icon src=https://jack-d-long.github.io/search.svg></button><div class="search-modal js" aria-labelledby=modalTitle id=searchModal role=dialog><div id=modal-content><h1 class=page-header id=modalTitle>Search</h1><div id=searchBar><input aria-controls=results-container aria-expanded=false autocomplete=off id=searchInput placeholder=Search... role=combobox spellcheck=false><button title="Clear search" class=clear-button id=clear-search><svg viewbox="0 -960 960 960" xmlns=http://www.w3.org/2000/svg><path d="m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"/></svg></button></div><div id=results-container><div id=results-info><span id=zero_results style=display:none>No results</span><span id=one_result style=display:none>1 result</span><span id=many_results style=display:none>$NUMBER results</span></div><div id=results role=listbox></div></div></div></div><a onclick="toggleTheme(); event.preventDefault();" href=# id=dark-mode-toggle> <img alt=Light id=sun-icon src=https://jack-d-long.github.io/feather/sun.svg style=filter:invert()> <img alt=Dark id=moon-icon src=https://jack-d-long.github.io/feather/moon.svg> </a><script>updateItemToggleTheme()</script></nav></header><main><article><div class=title><div class=page-header>Lab 10<span class=primary-color style=font-size:1.6em>.</span></div><div class=meta>Posted on <time>2025-04-22</time></div></div><div class=toc-container><h1 class=toc-title>Table of Contents</h1><ul class=toc-list><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#previous-lab-9>Previous: Lab 9</a> <ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#intro>Intro</a></li><ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#localization>Localization</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#bayes-filter>Bayes Filter</a></ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#lab-tasks>Lab Tasks</a></li><ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#control>Control</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#motion-model>Motion Model</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#prediction>Prediction</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#sensor-model>Sensor Model</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#update>Update</a></ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#execution>Execution</a></li><ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#video>Video</a><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#screenshots>Screenshots</a></ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#collaborations>Collaborations</a></ul><li><a href=https://jack-d-long.github.io/fast-robots/lab10/#next-lab-11>Next: Lab 11</a></ul></div><section class=body><h1 id=previous-lab-9><a aria-label="Anchor link for: previous-lab-9" class=zola-anchor href=#previous-lab-9>Previous: <a href=/fast-robots/lab9>Lab 9</a></a></h1><h2 id=intro><a aria-label="Anchor link for: intro" class=zola-anchor href=#intro>Intro</a></h2><p>The goal of Lab 10 was to simulate localization of our cars in the pre-defined world using the Bayes filter.<h3 id=localization><a aria-label="Anchor link for: localization" class=zola-anchor href=#localization>Localization</a></h3><p>Our cars don’t rely on localization, using sensor data and control inputs to estimate their position probabilistically, to navigate the world. This is done using a Bayes filter, which updates the robot's belief about its position as new data comes in.<p>The robot's state includes its position on the ground $(x, y)$ and its orientation ($\theta$). The ground plane is discretized into a grid with each cell representing a 1x1 ft space and 20° of orientation, resulting in a 12x9x18 state space.<h3 id=bayes-filter><a aria-label="Anchor link for: bayes-filter" class=zola-anchor href=#bayes-filter>Bayes Filter</a></h3><p>The Bayes filter operates in two steps:<p><strong>Prediction</strong>: The robot estimates its new position based on its previous pose and control inputs.<p><strong>Update</strong>: The robot refines its estimate using sensor readings.<p>The motion model calculates the likelihood of the robot transitioning from one pose to another, while the sensor model calculates the probability of sensor observations given the robot’s position. The filter iterates over all possible poses in the state space to update the belief, and repeats for each move.<h2 id=lab-tasks><a aria-label="Anchor link for: lab-tasks" class=zola-anchor href=#lab-tasks>Lab Tasks</a></h2><p>Per the notebook instructions, I wrote the following functions to simulate localization with the Bayes filter.<h3 id=control><a aria-label="Anchor link for: control" class=zola-anchor href=#control>Control</a></h3><p>I first wrote the <code>compute_control()</code> function, which takes the current and previous pose and returns the control input required to move from the previous to current. This forms the mean of a Gaussian distribution used to estimate the probability that the robot moved from its previous pose to the current one.<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span style=color:#fa6e32>def </span><span style=color:#f29718>compute_control</span><span>(</span><span style=color:#ff8f40>cur_pose</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>prev_pose</span><span>):
</span><span>    </span><span style=color:#abb0b6;font-style:italic>""" Given the current and previous odometry poses, this function extracts
</span><span style=color:#abb0b6;font-style:italic>    the control information based on the odometry motion model.
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Args:
</span><span style=color:#abb0b6;font-style:italic>        cur_pose  ([Pose]): Current Pose
</span><span style=color:#abb0b6;font-style:italic>        prev_pose ([Pose]): Previous Pose 
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Returns:
</span><span style=color:#abb0b6;font-style:italic>        [delta_rot_1]: Rotation 1  (degrees)
</span><span style=color:#abb0b6;font-style:italic>        [delta_trans]: Translation (meters)
</span><span style=color:#abb0b6;font-style:italic>        [delta_rot_2]: Rotation 2  (degrees)
</span><span style=color:#abb0b6;font-style:italic>    """
</span><span>    cur_x, cur_y, cur_theta </span><span style=color:#ed9366>= </span><span>cur_pose
</span><span>    prev_x, prev_y, prev_theta </span><span style=color:#ed9366>= </span><span>prev_pose
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Calculate the first rotation angle (in deg) before moving
</span><span>    delta_rot_1 </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>arctan2</span><span>(cur_y </span><span style=color:#ed9366>- </span><span>prev_y</span><span style=color:#61676ccc>, </span><span>cur_x </span><span style=color:#ed9366>- </span><span>prev_x) </span><span style=color:#ed9366>- </span><span>prev_theta
</span><span>    delta_rot_1 </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>degrees</span><span>((delta_rot_1 </span><span style=color:#ed9366>+ </span><span>np</span><span style=color:#ed9366>.</span><span>pi) </span><span style=color:#ed9366>% </span><span>(</span><span style=color:#ff8f40>2 </span><span style=color:#ed9366>* </span><span>np</span><span style=color:#ed9366>.</span><span>pi) </span><span style=color:#ed9366>- </span><span>np</span><span style=color:#ed9366>.</span><span>pi)  </span><span style=color:#abb0b6;font-style:italic># Normalize the angle to [-pi, pi], convert
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Calculate the translation
</span><span>    delta_trans </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>sqrt</span><span>((cur_x </span><span style=color:#ed9366>- </span><span>prev_x)</span><span style=color:#ed9366>**</span><span style=color:#ff8f40>2 </span><span style=color:#ed9366>+ </span><span>(cur_y </span><span style=color:#ed9366>- </span><span>prev_y)</span><span style=color:#ed9366>**</span><span style=color:#ff8f40>2</span><span>)
</span><span>    
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Calculate the second rotation angle (in deg) after moving
</span><span>    delta_rot_2 </span><span style=color:#ed9366>= </span><span>cur_theta </span><span style=color:#ed9366>- </span><span>prev_theta </span><span style=color:#ed9366>- </span><span>delta_rot_1
</span><span>    delta_rot_2 </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>degrees</span><span>((delta_rot_2 </span><span style=color:#ed9366>+ </span><span>np</span><span style=color:#ed9366>.</span><span>pi) </span><span style=color:#ed9366>% </span><span>(</span><span style=color:#ff8f40>2 </span><span style=color:#ed9366>* </span><span>np</span><span style=color:#ed9366>.</span><span>pi) </span><span style=color:#ed9366>- </span><span>np</span><span style=color:#ed9366>.</span><span>pi)  </span><span style=color:#abb0b6;font-style:italic># Normalize the angle to [-pi, pi], convert
</span><span>    
</span><span>    </span><span style=color:#fa6e32>return </span><span>delta_rot_1, delta_trans, delta_rot_2
</span><span>
</span></code></pre><h3 id=motion-model><a aria-label="Anchor link for: motion-model" class=zola-anchor href=#motion-model>Motion Model</a></h3><p>The odometry motion model gives information necessary for the prediction step of the Bayes filter: A state transition probability from the previous recorded pose to the current one. It does this knowing the current pose, previous pose, and actual vs. predicted control inputs (via <code>compute_control()</code>). The resulting transition probability is the product of the probabilities of each movement because they are executed in series.<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic>""" Odometry Motion Model
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Args:
</span><span style=color:#abb0b6;font-style:italic>        cur_pose  ([Pose]): Current Pose
</span><span style=color:#abb0b6;font-style:italic>        prev_pose ([Pose]): Previous Pose
</span><span style=color:#abb0b6;font-style:italic>        (rot1, trans, rot2) (float, float, float): A tuple with control data in the format 
</span><span style=color:#abb0b6;font-style:italic>                                                   format (rot1, trans, rot2) with units (degrees, meters, degrees)
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Returns:
</span><span style=color:#abb0b6;font-style:italic>        prob [float]: Probability p(x'|x, u)
</span><span style=color:#abb0b6;font-style:italic>    """
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Get control parameters from the current and previous poses
</span><span>    d_rot_1, d_trans, d_rot_2 </span><span style=color:#ed9366>= </span><span style=color:#f29718>compute_control</span><span>(cur_pose</span><span style=color:#61676ccc>, </span><span>prev_pose)
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Determine the probabilities of the control parameters
</span><span>    pr_rot_1 </span><span style=color:#ed9366>= </span><span>loc</span><span style=color:#ed9366>.</span><span style=color:#f29718>gaussian</span><span>(d_rot_1</span><span style=color:#61676ccc>, </span><span>u[</span><span style=color:#ff8f40>0</span><span>]</span><span style=color:#61676ccc>, </span><span>loc</span><span style=color:#ed9366>.</span><span>odom_rot_sigma)
</span><span>    pr_trans </span><span style=color:#ed9366>= </span><span>loc</span><span style=color:#ed9366>.</span><span style=color:#f29718>gaussian</span><span>(d_trans</span><span style=color:#61676ccc>, </span><span>u[</span><span style=color:#ff8f40>1</span><span>]</span><span style=color:#61676ccc>, </span><span>loc</span><span style=color:#ed9366>.</span><span>odom_trans_sigma)
</span><span>    pr_rot_2 </span><span style=color:#ed9366>= </span><span>loc</span><span style=color:#ed9366>.</span><span style=color:#f29718>gaussian</span><span>(d_rot_2</span><span style=color:#61676ccc>, </span><span>u[</span><span style=color:#ff8f40>2</span><span>]</span><span style=color:#61676ccc>, </span><span>loc</span><span style=color:#ed9366>.</span><span>odom_rot_sigma)
</span><span>
</span><span>    </span><span style=color:#fa6e32>return </span><span>pr_rot_1 </span><span style=color:#ed9366>* </span><span>pr_trans </span><span style=color:#ed9366>* </span><span>pr_rot_2
</span><span>
</span></code></pre><h3 id=prediction><a aria-label="Anchor link for: prediction" class=zola-anchor href=#prediction>Prediction</a></h3><p><code>prediction_step()</code> takes in odometry data and outputs the predicted belief $\overline{bel}$ of the robot's pose using the odometry model. It does this by iterating over each pose in the state space and calculating a transition probability for it using <code>odom_motion_model()</code>.<p>We don't deal with states with a transition probability of less than 0.0001 to speed up computation. Because the probability distribution will converge to a small enough range to be useful in reasonably short time, we are probably safe in doing this. As a result, we lose a bit of compleness in Bayes filter execution, but gain a lot of time.<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span>
</span><span style=color:#fa6e32>def </span><span style=color:#f29718>prediction_step</span><span>(</span><span style=color:#ff8f40>cur_odom</span><span style=color:#61676ccc>, </span><span style=color:#ff8f40>prev_odom</span><span>)
</span><span>  </span><span style=color:#abb0b6;font-style:italic># Initialize the predicted belief
</span><span>  loc</span><span style=color:#ed9366>.</span><span>bel_bar </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>zeros</span><span>((mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_X</span><span style=color:#61676ccc>, </span><span>mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_Y</span><span style=color:#61676ccc>, </span><span>mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_A))
</span><span>
</span><span>  </span><span style=color:#abb0b6;font-style:italic># Iterate over state space
</span><span>  </span><span style=color:#fa6e32>for </span><span>x_prev </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_X):
</span><span>      </span><span style=color:#fa6e32>for </span><span>y_prev </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_Y):
</span><span>          </span><span style=color:#fa6e32>for </span><span>theta_prev </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_A):
</span><span>              </span><span style=color:#abb0b6;font-style:italic># Skip unlikely states
</span><span>              </span><span style=color:#fa6e32>if </span><span>loc</span><span style=color:#ed9366>.</span><span>bel[x_prev, y_prev, theta_prev] </span><span style=color:#ed9366>&lt; </span><span style=color:#ff8f40>0</span><span style=color:#61676ccc>.</span><span style=color:#ff8f40>0001</span><span>: </span><span style=color:#fa6e32>continue
</span><span>
</span><span>              </span><span style=color:#abb0b6;font-style:italic># Loop through all possible current states
</span><span>              </span><span style=color:#fa6e32>for </span><span>x_curr </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_X):
</span><span>                  </span><span style=color:#fa6e32>for </span><span>y_curr </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_Y):
</span><span>                      </span><span style=color:#fa6e32>for </span><span>theta_curr </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_A):
</span><span>                          </span><span style=color:#abb0b6;font-style:italic># Calculate transition probability
</span><span>                          p </span><span style=color:#ed9366>= </span><span style=color:#f29718>odom_motion_model</span><span>(
</span><span>                              mapper</span><span style=color:#ed9366>.</span><span style=color:#f29718>from_map</span><span>(x_curr</span><span style=color:#61676ccc>, </span><span>y_curr</span><span style=color:#61676ccc>, </span><span>theta_curr)</span><span style=color:#61676ccc>,
</span><span>                              mapper</span><span style=color:#ed9366>.</span><span style=color:#f29718>from_map</span><span>(x_prev</span><span style=color:#61676ccc>, </span><span>y_prev</span><span style=color:#61676ccc>, </span><span>theta_prev)</span><span style=color:#61676ccc>,
</span><span>                              u
</span><span>                          )
</span><span>
</span><span>                          </span><span style=color:#abb0b6;font-style:italic># Update predicted belief
</span><span>                          loc</span><span style=color:#ed9366>.</span><span>bel_bar[x_curr, y_curr, theta_curr] </span><span style=color:#ed9366>+= </span><span>p </span><span style=color:#ed9366>* </span><span>loc</span><span style=color:#ed9366>.</span><span>bel[x_prev, y_prev, theta_prev]
</span><span>
</span><span>  </span><span style=color:#abb0b6;font-style:italic># Normalize the belief
</span><span>  loc</span><span style=color:#ed9366>.</span><span>bel_bar </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>sum</span><span>(loc</span><span style=color:#ed9366>.</span><span>bel_bar)
</span><span>
</span><span>
</span></code></pre><h3 id=sensor-model><a aria-label="Anchor link for: sensor-model" class=zola-anchor href=#sensor-model>Sensor Model</a></h3><p><code>sensor_model()</code> performs a similar function to our odometry motion model. Given a set of sensor observations at a pose, it returns the probability of that sensor observation.<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span style=color:#fa6e32>def </span><span style=color:#f29718>sensor_model</span><span>(</span><span style=color:#ff8f40>obs</span><span>):
</span><span>    </span><span style=color:#abb0b6;font-style:italic>""" Compute p(z|x), the likelihood of sensor measurements for a given pose.
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Args:
</span><span style=color:#abb0b6;font-style:italic>        obs (ndarray): 1D array of true sensor readings for a specific robot pose.
</span><span style=color:#abb0b6;font-style:italic>
</span><span style=color:#abb0b6;font-style:italic>    Returns:
</span><span style=color:#abb0b6;font-style:italic>        ndarray: 1D array of size 18 (loc.OBS_PER_CELL) with sensor measurement likelihoods.
</span><span style=color:#abb0b6;font-style:italic>    """
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Initialize the probability array
</span><span>    prob_array </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>zeros</span><span>(mapper</span><span style=color:#ed9366>.</span><span>OBS_PER_CELL)
</span><span>    
</span><span>    </span><span style=color:#fa6e32>for </span><span>i </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>OBS_PER_CELL):
</span><span>        </span><span style=color:#abb0b6;font-style:italic># Calculate the likelihood of each sensor reading
</span><span>        prob_array[i] </span><span style=color:#ed9366>= </span><span>loc</span><span style=color:#ed9366>.</span><span style=color:#f29718>gaussian</span><span>(obs[i]</span><span style=color:#61676ccc>, </span><span>loc</span><span style=color:#ed9366>.</span><span>obs_range_data[i]</span><span style=color:#61676ccc>, </span><span>loc</span><span style=color:#ed9366>.</span><span>sensor_sigma)
</span><span>
</span><span>    </span><span style=color:#fa6e32>return </span><span>prob_array
</span><span>
</span></code></pre><h3 id=update><a aria-label="Anchor link for: update" class=zola-anchor href=#update>Update</a></h3><p>As the final step in Bayes filter implementation, <code>update_step()</code> again iterates through all poses in the state space and updates the belief given the output of the sensor model (with <code>sensor_model()</code>) and predicted belief (updated in <code>prediction_step()</code>). It multiplies elements of the sensor model output for the final $$ p(z_t | x_t, m) = \prod_{k=1}^{18} p(z_t^k | x_t, m) $$<p>expression, and uses $p$ to to update the belief at each point before renormalizing the distribution.<pre class=language-python data-lang=python style=color:#61676c;background-color:#fafafa><code class=language-python data-lang=python><span>
</span><span style=color:#fa6e32>def </span><span style=color:#f29718>update_step</span><span>():
</span><span>    </span><span style=color:#abb0b6;font-style:italic>""" Update the belief (loc.bel) based on the predicted belief (loc.bel_bar) and the sensor model.
</span><span style=color:#abb0b6;font-style:italic>    """
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Iterate over the grid to update the belief
</span><span>    </span><span style=color:#fa6e32>for </span><span>x </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_X):
</span><span>        </span><span style=color:#fa6e32>for </span><span>y </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_Y):
</span><span>            </span><span style=color:#fa6e32>for </span><span>theta </span><span style=color:#fa6e32>in </span><span style=color:#f07171>range</span><span>(mapper</span><span style=color:#ed9366>.</span><span>MAX_CELLS_A):
</span><span>                </span><span style=color:#abb0b6;font-style:italic># Compute the sensor model likelihood for the current pose
</span><span>                p </span><span style=color:#ed9366>= </span><span style=color:#f29718>sensor_model</span><span>(mapper</span><span style=color:#ed9366>.</span><span style=color:#f29718>get_views</span><span>(x</span><span style=color:#61676ccc>, </span><span>y</span><span style=color:#61676ccc>, </span><span>theta))
</span><span>                
</span><span>                </span><span style=color:#abb0b6;font-style:italic># Update the belief for the current state
</span><span>                loc</span><span style=color:#ed9366>.</span><span>bel[x, y, theta] </span><span style=color:#ed9366>= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>prod</span><span>(p) </span><span style=color:#ed9366>* </span><span>loc</span><span style=color:#ed9366>.</span><span>bel_bar[x, y, theta]
</span><span>
</span><span>    </span><span style=color:#abb0b6;font-style:italic># Normalize the belief distribution
</span><span>    loc</span><span style=color:#ed9366>.</span><span>bel </span><span style=color:#ed9366>/= </span><span>np</span><span style=color:#ed9366>.</span><span style=color:#f29718>sum</span><span>(loc</span><span style=color:#ed9366>.</span><span>bel)
</span><span>
</span></code></pre><h2 id=execution><a aria-label="Anchor link for: execution" class=zola-anchor href=#execution>Execution</a></h2><h3 id=video><a aria-label="Anchor link for: video" class=zola-anchor href=#video>Video</a></h3><p>I recorded the first execution of the filter. Further executions are below.</p><iframe allowfullscreen height=500 src=https://youtube.com/embed/X1Gf_1Plwnw width=800></iframe><h3 id=screenshots><a aria-label="Anchor link for: screenshots" class=zola-anchor href=#screenshots>Screenshots</a></h3><img alt=Bayes!! src=/files/lab10/Bayes1.png width=800><img alt=Bayes!! src=/files/lab10/Bayes2.png width=800><img alt=Bayes!! src=/files/lab10/Bayes3.png width=800><img alt=Bayes!! src=/files/lab10/Bayes4.png width=800><p>There was more variability in the estimates than I expected, especially in open spaces where sensor data (even simulated) is less reliable. Still, they're miles better than the pure odometry model.<h2 id=collaborations><a aria-label="Anchor link for: collaborations" class=zola-anchor href=#collaborations>Collaborations</a></h2><p>I worked with <a href=https://correial.github.io/>Lucca Correia</a> and <a href=https://trevordales.github.io/>Trevor Dales</a> extensively. I referenced <a href=https://fast.synthghost.com/lab-10-simulated-localization>Stephan Wagner's</a> and <a href=https://mavisfu.github.io/lab10.html>Mavis Fu's</a> sites for code examples.<h1 id=next-lab-11><a aria-label="Anchor link for: next-lab-11" class=zola-anchor href=#next-lab-11>Next: <a href=/fast-robots/lab11>Lab 11</a></a></h1></section></article></main><div class=giscus></div><script -- <!-- <-- change repo src=https://utteranc.es/client.js this to your>issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async></script></div>